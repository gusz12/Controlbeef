<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>ControlBeef | Dashboard</title>
    <link rel="stylesheet" href="../css/dashboard.css">
    <link rel="stylesheet" href="../css/style.css">
</head>
<style>
    .grauDano {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 20px;
        margin-bottom: 20px;
    }

    .grauDano div {
        width: 125px;
        height: 50px;
    }

    .containerStatus {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        margin-top: 20px;
    }

    .containerStatus h1 {
        margin-right: 20px;
    }

    .status {
        display: grid;
        grid-template-columns: 32% 32% 32%;
        gap: 20px;
        width: 100%;
        height: 300px;
        overflow: hidden;
        overflow-y: scroll;
        background-color: #f0f0f0;
        border: solid 3px #5DD7ED;
        padding: 10px;
    }
</style>

<body onload="listarFrigorificos()">

    <div class="navbar">
        <div class="logo">
            <span>ControlBeef</span>
            <img src="assets/logoControlBeef1.png" alt="logo ControlBeef">
        </div>
        <div class="menu">
            <a href="../index.html">Home</a>
            <span>|</span>
            <a href="../sobrenos.html">Sobre Nós</a>
            <span>|</span>
            <a href="../registro.html">Cadastrar</a>
            <span>|</span>
            <a href="../login.html">Dashboard</a>
        </div>
        <div class="usuario">
            <!-- <img src="assets/free-user-icon-3296-thumb.png" class="user-avatar" alt="Usuário"> -->
            <span style="font-size: 50px;" id="nome_lateral"></span>
        </div>
    </div>

    <div class="main-content">
        <div class="mensagemInicial">
            <span style=" font-size: 30px" id="nomeBemVindo"></span>
        </div>


        <div class="grauDano">

            <div
                style="background-color: red; text-align: center; font-size: 18px; display: flex; justify-content: center; align-items: center;">
                Fora do ideal (&lt; -3°C e &gt; 4°C) </div>
            <div
                style="background-color: yellow; text-align: center; font-size: 18px; display: flex; justify-content: center; align-items: center; margin-left: 10px;">
                Em alerta <br>(-3ºC e 4ºC)</div>
            <div
                style="background-color: green; text-align: center; font-size: 18px; display: flex; justify-content: center; align-items: center; margin-left: 10px;">
                Ideal<br> (&gt;-3°C e &lt;4°C)</div>

        </div>

        <div class="containerStatus">

            <h1>Status</h1>

            <div id="Container" class="status">

            </div>
        </div>

        <div class="containerFrigorifico">
            <select id="select_frigo" class="select_Frigo">
                <option value="#">Escolha um Frigorifico</option>
            </select>

            <button onclick="filtroFrigorifico()">Mostrar Frigorifico</button>
        </div>

        <div class="containerSalas">
            <div id="div_salas" class="tabela_salas"></div>
        </div>
        <div id="container" style="display: none; flex-direction: column; align-items: end;">
            <h1>Salas com maior problema</h1>
            <div class="container" id="ranking"></div>
        </div>
    </div>
    </div>

</body>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    var nome_user = sessionStorage.NOME_USUARIO;
    var idEmpresa = sessionStorage.ID_EMPRESA;
    nomeBemVindo.innerHTML = `Bem-vindo(a) de volta, ${nome_user}.`
    nome_lateral.innerHTML = `${nome_user}`

    let idFrigorifico = 0;
    function listarFrigorificos() {

        Container.innerHTML = ""
        fetch(`/dashboard/listarFrigorifico/${idEmpresa}`, {
            method: "GET"
        })
            .then(res => {
                res.json().then(json => {

                    console.log(res)
                    console.log(json)
                    for (c = 0; json.length > c; c++) {
                        const frigorificos = json[c];

                        Container.innerHTML += `
                    <div class="card">
                        <div class="bolaeTemperatura">
                            <p>Temperatura: ${frigorificos.sensor_analogico}</p>
                            <div class="bolinha" id="bolinha${c}">
                            </div>
                        </div>
                        <p>Figorifico: ${frigorificos.nomeFrigo}</p>
                        <p>Sala: ${frigorificos.nomeSala}</p>
                    </div>
            `;
                    }
                    for (c = 0; json.length > c; c++) {
                        const frigorificos = json[c];

                        console.log(frigorificos.Status_alerta)
                        let bolinhas = document.getElementById('bolinha' + c);

                        if (frigorificos.Status_alerta == 'Alerta') {
                            bolinhas.style.backgroundColor = "#ffff00";
                        } else if (frigorificos.Status_alerta == "Crítico") {
                            bolinhas.style.backgroundColor = "#ff0000";
                        } else {
                            bolinhas.style.backgroundColor = "#008000";
                        }
                    }

                    select_frigo.innerHTML = `<option value="#">Escolha um Frigorifico</option>`

                    var frigos = [];

                    for (c = 0; json.length > c; c++) {
                        let frigorificos = json[c];

                        if (!frigos.includes(frigorificos.nomeFrigo)) {
                            frigos.push(frigorificos.nomeFrigo)
                            select_frigo.innerHTML +=
                                `
                                        <option value="${frigorificos.idFrigorifico}">${frigorificos.nomeFrigo}</option>
                                    `
                        }
                    }
                })
            })


    }
    select_frigo.addEventListener('change', function () {
        idFrigorifico = select_frigo.value;
        console.log('Frigorífico selecionado:', idFrigorifico);
    });
    function filtroFrigorifico() {
        console.log("Valor do select: ", idFrigorifico)
        fetch(`/dashboard/filtroFrigorifico/${idEmpresa}/${idFrigorifico}`, {
            method: "GET"
        })
            .then(res => {
                res.json().then(json => {
                    container.style.display = "flex"
                    ranking.innerHTML = ""

                    for (let c = 0; json.length > c; c++) {
                        frigorificos = json[c]
                        ranking.innerHTML +=
                            `
                            <div class="sala">
                     <p>${frigorificos.nomeSala}</p>
                     <p>${frigorificos.dadosSensor}</p>
                     <p>Quantidade de Vezes fora do ideal</p>
                     <p>Tempo fora do ideal</p>           
                    </div>
                            `
                    }

                })
            })
    }

</script>